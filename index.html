<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Possible Studio Rental Manager</title>
  <link rel="icon" href="favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .form-section {
      transition: all 0.3s ease-in-out;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
    }
    .form-section.open {
      max-height: 500px; /* Adjust as needed */
      opacity: 1;
    }
    @media print {
      body, main, .container {
        background: white !important; color: black !important; margin: 0 !important; padding: 0 !important; max-width: 100% !important; font-family: serif !important; font-size: 12pt !important;
      }
      header, form, button, .print\:hidden {
        display: none !important;
      }
      .summary-print-container {
        box-shadow: none !important; padding: 0 !important; margin: 0 0 1rem 0 !important; background: transparent !important; border: none !important;
      }
      table {
        width: 100% !important; border-collapse: collapse !important; font-size: 10pt !important; color: black !important;
      }
      thead, tbody, tr, th, td {
        border: 1px solid black !important; padding: 2px 4px !important; background: transparent !important;
      }
      th { font-weight: bold !important; background: #eee !important; }
      tr { page-break-inside: avoid; }
      div, p, h1, h2, h3, h4, h5, h6 { margin: 0 !important; padding: 0 !important; }
      h1, h2 { font-weight: bold !important; margin-bottom: 0.3em !important; }
    }
  </style>

  <!-- React and ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase UMD SDK (Global Scope) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="bg-black text-white">
  <div id="root"></div>

  <script>
    const { useState, useEffect, useMemo, createElement, Fragment } = React;
    const ReactDOM = window.ReactDOM;
    
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAIHIVv6dJ0LlNqP_0qkYNok7xsbxHgdRY",
      authDomain: "studio-space-rental-database.firebaseapp.com",
      databaseURL: "https://studio-space-rental-database-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "studio-space-rental-database",
      storageBucket: "studio-space-rental-database.appspot.com",
      messagingSenderId: "176375720882",
      appId: "1:176375720882:web:ac012e2d33e8fec5ca52ab",
      measurementId: "G-NWZ18H2CVT"
    };

    // Initialize Firebase using the global 'firebase' object
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database(); // Get database instance from the app
    const rentalsRef = database.ref('rentals'); // Reference to the 'rentals' collection
    const rentalsQuery = rentalsRef.orderByChild('date'); // Query ordered by date

    // Helpers
    function getTodayDateString() {
      const today = new Date();
      const offset = today.getTimezoneOffset();
      const todayLocal = new Date(today.getTime() - offset * 60 * 1000);
      return todayLocal.toISOString().split('T')[0];
    }

    // Constants:
    const ADMIN_PASSWORD = "1122";
    const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const PAYMENT_METHODS = ['UPI', 'Cash', 'Cards'];

    // Components
    function LoadingSpinner() {
      return createElement('div', { className: "flex flex-col items-center justify-center gap-2" },
        createElement('div', { className: "w-12 h-12 rounded-full animate-spin border-4 border-solid border-yellow-400 border-t-transparent", role: "status", "aria-label": "loading" }),
        createElement('p', { className: "text-gray-400" }, "Loading Bookings...")
      );
    }

    function LoginModal({ isOpen, onClose, onLogin }) {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      useEffect(() => { setPassword(''); setError(''); }, [isOpen]);
      if (!isOpen) return null;
      function handleSubmit(e) {
        e.preventDefault();
        if (!onLogin(password)) { setError('Invalid password. Please try again.'); setPassword(''); }
      }
      return createElement('div', { className: "fixed inset-0 bg-black/70 flex items-center justify-center z-50", onClick: onClose },
        createElement('div', { className: "bg-gray-900 p-8 rounded-xl shadow-lg ring-1 ring-yellow-400/50 w-full max-w-sm m-4", onClick: e => e.stopPropagation() },
          createElement('h2', { className: "text-2xl font-bold text-white mb-4" }, "Admin Login"),
          createElement('form', { onSubmit: handleSubmit },
            createElement('input', { type: "password", className: "w-full px-4 py-3 bg-gray-800 border border-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400 mb-4", placeholder: "Enter admin password", value: password, onChange: e => setPassword(e.target.value), autoFocus: true }),
            error && createElement('p', { className: "text-red-400 text-center mb-4" }, error),
            createElement('button', { type: "submit", className: "w-full bg-yellow-400 text-black font-bold py-3 rounded-lg hover:bg-yellow-500" }, "Login")
          )
        )
      );
    }
    
    function RentalForm({ rentalToEdit, onSubmitSuccess, onCancel }) {
      const initialFormData = {
          clientName: '',
          date: getTodayDateString(),
          startTime: '10:00',
          endTime: '18:00',
          isOutside: false,
          location: '',
          withEquipment: false,
          hasCamera: false, // New state for camera checkbox
          cameras: 1, // Default camera count
          mic: false,
          lights: false,
          note: '',
          paidAmount: 0,
          paymentMethod: 'UPI',
          isAdvance: false,
      };

      const [formData, setFormData] = useState(rentalToEdit ? { ...initialFormData, ...rentalToEdit } : initialFormData);
      const [isSubmitting, setIsSubmitting] = useState(false);
      const [error, setError] = useState('');

      useEffect(() => {
          if (rentalToEdit) setFormData({ ...initialFormData, ...rentalToEdit });
          else setFormData(initialFormData);
          setError('');
      }, [rentalToEdit]);

      function handleChange(e) {
          const { name, value, type, checked } = e.target;
          const val = type === 'checkbox' ? checked : value;

          setFormData(fd => {
              const newFd = { ...fd, [name]: val };
              if (name === 'isOutside' && !checked) newFd.location = '';
              if (name === 'withEquipment' && !checked) {
                  newFd.hasCamera = false; // Reset camera checkbox if no equipment
                  newFd.cameras = 1; // Reset camera count
                  newFd.mic = false;
                  newFd.lights = false;
              }
              if (name === 'hasCamera' && !checked) {
                  newFd.cameras = 1; // Reset camera count if camera checkbox is unchecked
              }
              return newFd;
          });
      }

      async function handleSubmit(e) {
          e.preventDefault();
          setError('');

          if (!formData.clientName || !formData.date || !formData.startTime || !formData.endTime) {
              setError("Client Name, Date, Start Time and End Time are required.");
              return;
          }
          if(formData.startTime >= formData.endTime) {
              setError("End time must be after start time.");
              return;
          }
          if(formData.isOutside && !formData.location) {
              setError("Location is required for outside shoots.");
              return;
          }
          // Validation for cameras if hasCamera is true
          if (formData.hasCamera && (formData.cameras < 1 || isNaN(formData.cameras))) {
              setError("Number of cameras must be at least 1 when 'Camera' is selected.");
              return;
          }


          setIsSubmitting(true);
          try {
              const dataToSave = { ...formData, timestamp: Date.now() };
              // Ensure cameras is only saved if hasCamera is true, otherwise set to 0 or null
              if (!formData.hasCamera) {
                  dataToSave.cameras = 0; // Or delete dataToSave.cameras;
              }

              if (rentalToEdit && rentalToEdit.id) {
                  await rentalsRef.child(rentalToEdit.id).update(dataToSave);
              } else {
                  await rentalsRef.push(dataToSave);
              }
              onSubmitSuccess(rentalToEdit ? "Booking updated successfully" : "Booking added successfully");
          } catch (err) {
              setError("Error saving data to Firebase.");
              console.error(err);
          } finally {
              setIsSubmitting(false);
          }
      }
      
      const isEditing = !!(rentalToEdit && rentalToEdit.id);
      const inputClasses = "w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 outline-none transition-colors";
      const labelClasses = "block text-sm font-medium text-gray-300 mb-1";
      const checkboxLabelClasses = "flex items-center space-x-3 text-white cursor-pointer";
      const checkboxClasses = "h-5 w-5 rounded bg-gray-700 border-gray-500 text-yellow-400 focus:ring-yellow-400 cursor-pointer";

      return createElement('div', { className: "bg-gray-900 p-6 md:p-8 rounded-xl shadow-lg ring-1 ring-gray-800 print:hidden mb-8" },
          createElement('h2', { className: "text-2xl font-bold mb-6 text-yellow-400" }, isEditing ? "Edit Booking" : "New Studio Booking"),
          error && createElement('div', { className: "bg-red-900/50 px-4 py-3 rounded mb-4 text-red-300" }, error),
          createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
              createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700" },
                createElement('label', { className: checkboxLabelClasses },
                  createElement('input', { type: "checkbox", name: "isOutside", className: checkboxClasses, checked: formData.isOutside, onChange: handleChange }),
                  createElement('span', null, "Outside the Studio")
                ),
                createElement('div', { className: `form-section ${formData.isOutside ? 'open' : ''}` },
                  createElement('div', { className: "mt-3" },
                      createElement('label', { htmlFor: "location", className: labelClasses }, "Location"),
                      createElement('input', { id: "location", name: "location", type: "text", className: inputClasses, value: formData.location, onChange: handleChange, placeholder: "e.g., Downtown Park" })
                  )
                )
              ),
              createElement('div', null,
                  createElement('label', { htmlFor: "clientName", className: labelClasses }, "Client Name"),
                  createElement('input', { id: "clientName", name: "clientName", type: "text", className: inputClasses, value: formData.clientName, onChange: handleChange, required: true, placeholder: "John Doe" })
              ),
              createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                  createElement('div', null,
                      createElement('label', { htmlFor: "date", className: labelClasses }, "Date"),
                      createElement('input', { id: "date", name: "date", type: "date", className: inputClasses, value: formData.date, onChange: handleChange, required: true })
                  ),
                  createElement('div', null,
                      createElement('label', { htmlFor: "startTime", className: labelClasses }, "Start Time"),
                      createElement('input', { id: "startTime", name: "startTime", type: "time", className: inputClasses, value: formData.startTime, onChange: handleChange, required: true })
                  ),
                   createElement('div', null,
                      createElement('label', { htmlFor: "endTime", className: labelClasses }, "End Time"),
                      createElement('input', { id: "endTime", name: "endTime", type: "time", className: inputClasses, value: formData.endTime, onChange: handleChange, required: true })
                  )
              ),
              createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700" },
                  createElement('label', { className: checkboxLabelClasses },
                      createElement('input', { type: "checkbox", name: "withEquipment", className: checkboxClasses, checked: formData.withEquipment, onChange: handleChange }),
                      createElement('span', null, "With Equipment")
                  ),
                  createElement('div', { className: `pl-2 ml-2 border-l-2 border-yellow-400/50 form-section ${formData.withEquipment ? 'open' : ''}` },
                    createElement('div', { className: "mt-4 space-y-4" },
                      // New Camera checkbox
                      createElement('div', null,
                          createElement('label', { className: checkboxLabelClasses },
                              createElement('input', { type: "checkbox", name: "hasCamera", className: checkboxClasses, checked: formData.hasCamera, onChange: handleChange }),
                              createElement('span', null, "Camera")
                          )
                      ),
                      // Conditional rendering for No. of Cameras
                      formData.hasCamera && createElement('div', null,
                          createElement('label', { htmlFor: "cameras", className: labelClasses }, "No. of Cameras"),
                          createElement('input', { id: "cameras", name: "cameras", type: "number", min: "1", className: inputClasses, value: formData.cameras, onChange: handleChange })
                      ),
                      // Mic as a checkbox
                      createElement('div', null,
                          createElement('label', { className: checkboxLabelClasses },
                              createElement('input', { type: "checkbox", name: "mic", className: checkboxClasses, checked: formData.mic, onChange: handleChange }),
                              createElement('span', null, "Mic")
                          )
                      ),
                      createElement('div', null,
                          createElement('label', { className: checkboxLabelClasses },
                              createElement('input', { type: "checkbox", name: "lights", className: checkboxClasses, checked: formData.lights, onChange: handleChange }),
                              createElement('span', null, "Lights")
                          )
                      )
                    )
                  )
              ),
               createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700 space-y-4" },
                  createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                      createElement('div', null,
                          createElement('label', { htmlFor: "paidAmount", className: labelClasses }, "Paid Amount (₹)"),
                          createElement('input', { id: "paidAmount", name: "paidAmount", type: "number", step: "0.01", min: "0", className: inputClasses, value: formData.paidAmount, onChange: handleChange, placeholder: "e.g., 5000" })
                      ),
                      createElement('div', null,
                          createElement('label', { htmlFor: "paymentMethod", className: labelClasses }, "Payment Method"),
                          createElement('select', { id: "paymentMethod", name: "paymentMethod", className: inputClasses, value: formData.paymentMethod, onChange: handleChange },
                              PAYMENT_METHODS.map(m => createElement('option', { key: m, value: m }, m))
                          )
                      )
                  ),
                   createElement('div', null,
                      createElement('label', { className: checkboxLabelClasses },
                          createElement('input', { type: "checkbox", name: "isAdvance", className: checkboxClasses, checked: formData.isAdvance, onChange: handleChange }),
                          createElement('span', null, "This is an advance payment")
                      )
                  )
              ),
              createElement('div', null,
                  createElement('label', { htmlFor: "note", className: labelClasses }, "Note (Optional)"),
                  createElement('textarea', { id: "note", name: "note", rows: 3, className: inputClasses, value: formData.note, onChange: handleChange, placeholder: "Any special requests or details..." })
              ),
              createElement('div', { className: "flex justify-end space-x-3 pt-4" },
                  createElement('button', { type: "button", onClick: onCancel, className: "px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors" }, "Cancel"),
                  createElement('button', { type: "submit", disabled: isSubmitting, className: "px-4 py-2 rounded-md bg-yellow-400 text-black font-bold hover:bg-yellow-500 transition-colors disabled:bg-yellow-400/50" },
                      isSubmitting ? "Saving..." : (isEditing ? "Update Booking" : "Add Booking"))
              )
          )
      );
    }
    
    function RentalList({ title, rentals, isAdmin, onEdit, onDelete, isTodayList = false }) {
      if (!rentals.length) {
          if (!title) return null; // Don't render anything if no title and no rentals (for the 'other bookings' list)
          return createElement("div", { className: "mb-12" },
              createElement('h2', { className: "text-3xl font-bold text-yellow-400 border-b-2 border-gray-700 pb-2 mb-6" }, title),
              createElement("div", { className: "text-center py-10 px-6 bg-gray-900 rounded-lg border border-dashed border-gray-700" },
                  createElement("p", { className: "text-gray-400" }, isTodayList ? "No shoots scheduled for today." : "No bookings found for the selected month.")
              )
          );
      }

      const headerTitles = ["Client", "Timing", "Location/Equipment", "Payment", "Notes"];

      return createElement("div", { className: "mb-12" },
          title && createElement('h2', { className: "text-3xl font-bold text-yellow-400 border-b-2 border-gray-700 pb-2 mb-6" }, title),
          createElement("div", { className: "bg-gray-900 rounded-xl shadow-lg ring-1 ring-gray-800 overflow-hidden" },
              createElement("div", { className: "overflow-x-auto" },
                  createElement("table", { className: "w-full text-sm text-left text-gray-400" },
                      createElement("thead", { className: "text-xs text-gray-300 uppercase bg-gray-800" },
                          createElement("tr", null,
                              headerTitles.map(h => createElement("th", { key: h, className: "px-6 py-3" }, h)),
                              isAdmin && createElement("th", { className: "px-6 py-3 print:hidden text-right" }, "Actions")
                          )
                      ),
                      createElement("tbody", null,
                          rentals.map(r =>
                              createElement("tr", { key: r.id, className: "border-b border-gray-800 hover:bg-gray-800/50" },
                                  createElement("td", { className: "px-6 py-4 font-medium text-white" },
                                      createElement(Fragment, null,
                                          r.clientName || "-",
                                          !isTodayList && createElement("div", { className: "text-xs text-gray-500" }, r.date)
                                      )
                                  ),
                                  createElement("td", { className: "px-6 py-4" }, r.startTime && r.endTime ? `${r.startTime} - ${r.endTime}` : (r.startTime || "-")),
                                  createElement("td", { className: "px-6 py-4" },
                                      createElement('div', { className: "flex flex-col gap-1" },
                                          r.isOutside ?
                                          createElement('span', { className: "flex items-center gap-2" },
                                              createElement('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", className: "w-4 h-4 text-yellow-400" }, createElement('path', { fillRule: "evenodd", d: "M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.1.4-.27.61-.473A10.5 10.5 0 0016 11.25c0-2.278-1.543-4.37-3.692-5.404a5.813 5.813 0 00-1.74-1.636l-.001-.001-.002-.002-.002-.002-.001-.001A5.812 5.812 0 0010 3.75c-1.39 0-2.678.57-3.568 1.46-1.258 1.258-1.42 3.43.033 4.912A10.5 10.5 0 004 11.25c0 2.278 1.543 4.37 3.692 5.404l.002.001.002.002.002.002.001.001a5.813 5.813 0 001.74 1.636l.001.001.002.002.002.002.001.001zM10 13a2 2 0 100-4 2 2 0 000 4z", clipRule: "evenodd" })),
                                              r.location
                                          ) :
                                          createElement('span', null, 'In Studio'),
                                          r.withEquipment &&
                                          createElement('span', { className: "text-xs text-gray-500" },
                                              [
                                                  r.hasCamera && r.cameras > 0 && `${r.cameras} cam`, // Display based on hasCamera and count
                                                  r.mic && `mic`,
                                                  r.lights && `lights`
                                              ].filter(Boolean).join(' / ')
                                          )
                                      )
                                  ),
                                  createElement("td", { className: "px-6 py-4" },
                                      createElement('div', { className: "flex flex-col" },
                                          createElement('span', { className: "font-semibold text-yellow-400" }, `₹${r.paidAmount?.toLocaleString("en-IN") ?? "0"}`),
                                          createElement('span', { className: "text-xs text-gray-500" }, `${r.paymentMethod || ''}${r.isAdvance ? ' (Advance)' : ''}`)
                                      )
                                  ),
                                  createElement("td", { className: "px-6 py-4 min-w-[200px] text-gray-500 italic" }, r.note ? `"${r.note}"` : "-"),
                                  isAdmin &&
                                  createElement("td", { className: "px-6 py-4 print:hidden text-right" },
                                      createElement("div", { className: "flex items-center justify-end space-x-1" },
                                          createElement("button", { onClick: () => onEdit(r), className: "p-2 text-yellow-400 hover:bg-yellow-400/20 rounded-full", title: "Edit" },
                                              createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, createElement("path", { d: "M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" }))
                                          ),
                                          createElement("button", { onClick: () => { if (confirm("Delete this booking permanently?")) onDelete(r.id); }, className: "p-2 text-red-500 hover:bg-red-500/20 rounded-full", title: "Delete" },
                                              createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, createElement("path", { d: "M3 6h18" }), createElement("path", { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" }))
                                          )
                                      )
                                  )
                              )
                          )
                      )
                  )
              )
          )
      );
    }
    
    function Summary({ rentals }) {
      const stats = useMemo(() => {
          const totalAmount = rentals.reduce((a, e) => a + (e.paidAmount || 0), 0);
          return { totalAmount, totalShoots: rentals.length };
      }, [rentals]);

      return createElement("div", null,
          createElement("h3", { className: "text-xl font-bold mb-4 text-white" }, "Monthly Summary"),
          createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 text-center" },
              createElement("div", { className: "bg-gray-800/50 p-4 rounded-lg ring-1 ring-gray-700" },
                  createElement("p", { className: "text-sm text-yellow-400 font-semibold" }, "Total Revenue"),
                  createElement("p", { className: "text-2xl font-bold text-white mt-1" }, `₹${stats.totalAmount.toLocaleString("en-IN")}`)
              ),
              createElement("div", { className: "bg-gray-800/50 p-4 rounded-lg ring-1 ring-gray-700" },
                  createElement("p", { className: "text-sm text-yellow-400 font-semibold" }, "Total Shoots"),
                  createElement("p", { className: "text-2xl font-bold text-white mt-1" }, stats.totalShoots)
              )
          )
      );
    }

    function App() {
      const [isAdmin, setIsAdmin] = useState(false);
      const [showLogin, setShowLogin] = useState(false);
      const [showForm, setShowForm] = useState(false);
      const [bookings, setBookings] = useState([]);
      const [editBooking, setEditBooking] = useState(null);
      const [loading, setLoading] = useState(true);
      const [selectedMonth, setSelectedMonth] = useState(String(new Date().getMonth() + 1));
      const [error, setError] = useState('');
      const [successMsg, setSuccessMsg] = useState('');
      const [currentTime, setCurrentTime] = useState(new Date());
      
      useEffect(() => {
        const timer = setInterval(() => setCurrentTime(new Date()), 60000); // Refresh every minute
        return () => clearInterval(timer);
      }, []);

      useEffect(() => {
          // Use onValue from Firebase Realtime Database with the compat library
          const onDataChange = snapshot => {
              const arr = [];
              snapshot.forEach(child => {
                  const val = child.val();
                  if (val) arr.push({ ...val, id: child.key, paidAmount: Number(val.paidAmount) || 0 });
              });
              const sorted = arr.sort((a,b) => {
                  const valA = `${a.date || '0000-00-00'} ${a.startTime || '00:00'}`;
                  const valB = `${b.date || '0000-00-00'} ${b.startTime || '00:00'}`;
                  return valB.localeCompare(valA); // Sort descending by default
              });
              setBookings(sorted);
              setLoading(false);
          };
          const onError = err => { setError("Failed to load bookings."); setLoading(false); console.error(err); };
          
          // Attach the listener
          rentalsQuery.on('value', onDataChange, onError);

          // Return a cleanup function
          return () => rentalsQuery.off('value', onDataChange);
      }, []);

      function displayMessage(setter, msg) {
          setter(msg);
          setTimeout(() => setter(""), 3000);
      }

      function doLogin(pwd) {
          if (pwd === ADMIN_PASSWORD) { setIsAdmin(true); setShowLogin(false); return true; }
          return false;
      }

      function doLogout() {
          setIsAdmin(false);
          setEditBooking(null);
          setShowForm(false);
      }

      async function handleDelete(id) {
          try {
              await rentalsRef.child(id).remove();
              displayMessage(setSuccessMsg, "Booking deleted.");
          } catch (e) {
              displayMessage(setError, "Delete failed.");
              console.error(e);
          }
      }

      function handleEdit(booking) {
          setEditBooking(booking);
          setShowForm(true);
          window.scrollTo({ top: 0, behavior: "smooth" });
      }
      
      function handleAddNewClick() {
          setEditBooking(null);
          setShowForm(true);
      }
      
      function handleCancelForm() {
          setEditBooking(null);
          setShowForm(false);
      }

      function handleSuccess(msg) {
          displayMessage(setSuccessMsg, msg);
          setEditBooking(null);
          setShowForm(false);
      }
      
      const { upcomingBookings, todaysBookings, pastBookings } = useMemo(() => {
          const now = currentTime;
          const todayStr = getTodayDateString();
          
          const upcoming = [];
          const todays = [];
          const past = [];

          bookings.forEach(b => {
              if (!b.date || !b.startTime || !b.endTime) {
                  past.push(b); // Put incomplete records in past
                  return; 
              }
              const endDateTime = new Date(`${b.date}T${b.endTime}`);
              const dateOnly = new Date(b.date);
              dateOnly.setHours(0,0,0,0);
              const todayDateOnly = new Date(todayStr);
              todayDateOnly.setHours(0,0,0,0);

              if (endDateTime < now) {
                  past.push(b);
              } else if (b.date === todayStr) {
                  todays.push(b);
              } else if (dateOnly > todayDateOnly) {
                  upcoming.push(b);
              } else { // Handle edge case of past date but not yet ended (e.g., multi-day shoot)
                  todays.push(b);
              }
          });

          const ascSort = (a, b) => new Date(`${a.date}T${a.startTime}`) - new Date(`${b.date}T${b.startTime}`);
          upcoming.sort(ascSort);
          todays.sort(ascSort);

          return { upcomingBookings: upcoming, todaysBookings: todays, pastBookings: past };
      }, [bookings, currentTime]);

      const filteredUpcomingBookings = useMemo(() => {
          if (selectedMonth === "all") return upcomingBookings;
          return upcomingBookings.filter(b => b.date && new Date(b.date).getMonth() + 1 === Number(selectedMonth));
      }, [upcomingBookings, selectedMonth]);

      const filteredPastBookings = useMemo(() => {
          if (selectedMonth === "all") return pastBookings;
          return pastBookings.filter(b => b.date && new Date(b.date).getMonth() + 1 === Number(selectedMonth));
      }, [pastBookings, selectedMonth]);

      return createElement('div', { className: "container mx-auto p-4 md:p-8 max-w-7xl" },
          createElement('header', { className: "flex flex-col sm:flex-row justify-between items-center gap-4 mb-8" },
              createElement('h1', { className: "text-2xl md:text-3xl font-bold text-white tracking-tight" }, "Possible ", createElement('span', { className: "text-yellow-400" }, "Studio "), "Manager"),
              createElement('div', { className: "flex items-center gap-3 print:hidden" },
                  isAdmin && createElement('button', { onClick: handleAddNewClick, className: "flex items-center space-x-2 bg-yellow-400 text-black font-bold px-4 py-2 rounded-lg hover:bg-yellow-500 transition-all duration-200 transform hover:scale-105" }, 
                    createElement('svg', {xmlns:"http://www.w3.org/2000/svg", fill:"none", viewBox:"0 0 24 24", strokeWidth:2, stroke:"currentColor", className:"w-5 h-5"}, createElement('path', {strokeLinecap:"round", strokeLinejoin:"round", d:"M12 4.5v15m7.5-7.5h-15"})),
                    createElement('span', {className:"hidden sm:inline"}, "Add Booking")
                  ),
                  isAdmin ? createElement('button', { onClick: doLogout, className: "bg-gray-800 text-white font-semibold py-2 px-4 rounded-md hover:bg-gray-700 ring-1 ring-gray-600" }, "Logout")
                      : createElement('button', { onClick: () => setShowLogin(true), className: "bg-yellow-400 text-black font-bold py-2 px-4 rounded-md hover:bg-yellow-500" }, "Admin Login")
              )
          ),

          successMsg && createElement('div', { className: "bg-green-900/70 border border-green-500/50 text-green-300 px-4 py-3 rounded-md mb-4", role: "alert" }, successMsg),
          error && createElement('div', { className: "bg-red-900/70 border border-red-500/50 text-red-300 px-4 py-3 rounded-md mb-4", role: "alert" }, error),
          createElement(LoginModal, { isOpen: showLogin, onClose: () => setShowLogin(false), onLogin: doLogin }),

          isAdmin && showForm && createElement(RentalForm, { rentalToEdit: editBooking, onSubmitSuccess: handleSuccess, onCancel: handleCancelForm }),

          loading ? createElement(LoadingSpinner) : 
          createElement(Fragment, null, 
              createElement(RentalList, { title: "Today's Shoots", rentals: todaysBookings, isAdmin: isAdmin, onEdit: handleEdit, onDelete: handleDelete, isTodayList: true }),
              
              createElement('div', { className: "my-8" },
                  createElement('div', { className: "flex flex-col sm:flex-row justify-between items-center gap-4 mb-6" },
                      createElement('h2', { className: "text-3xl font-bold text-yellow-400 border-b-2 border-gray-700 pb-2" }, "Upcoming Bookings"),
                      createElement('div', null,
                          createElement('label', { htmlFor: "month-filter", className: "font-semibold text-gray-400 mr-2" }, "Filter by Month:"),
                          createElement('select', { id: "month-filter", className: "bg-gray-800 border border-gray-700 rounded-md px-2 py-1 text-white", value: selectedMonth, onChange: e => setSelectedMonth(e.target.value) },
                              createElement('option', { value: "all" }, "All Months"),
                              MONTHS.map((m, i) => createElement('option', { key: i, value: i + 1 }, m))
                          )
                      )
                  ),
                  createElement(RentalList, { 
                      rentals: filteredUpcomingBookings, 
                      isAdmin: isAdmin, 
                      onEdit: handleEdit, 
                      onDelete: handleDelete 
                  })
              ),
              
              createElement(RentalList, { title: "Past Bookings", rentals: filteredPastBookings, isAdmin: isAdmin, onEdit: handleEdit, onDelete: handleDelete }),

              createElement('div', { className: "my-8 bg-gray-900 p-4 sm:p-6 rounded-xl shadow-md ring-1 ring-gray-800 summary-print-container" },
                  createElement(Summary, { rentals: filteredPastBookings }),
                  createElement('button', { onClick: () => window.print(), className: "w-full mt-4 bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600 print:hidden" }, "Print Filtered Report")
              )
          )
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(createElement(App));
  </script>
</body>
</html>
