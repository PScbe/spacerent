<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Possible Studio Rental Manager</title>
  <!-- Inline SVG favicon to prevent console errors -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23facc15'/></svg>" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Firebase v8 SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .form-section {
      transition: all 0.3s ease-in-out;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
    }
    .form-section.open {
      max-height: 1000px; 
      opacity: 1;
    }
    .checkbox-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.25rem;
        border-radius: 0.5rem;
        border: 1px solid;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        font-weight: 500;
        color: #d1d5db;
        background-color: #1f2937;
        border-color: #4b5563;
        white-space: nowrap;
    }
    .checkbox-button:hover {
        background-color: #374151;
        border-color: #6b7280;
    }
    .checkbox-button.checked {
        background-color: #facc15;
        color: #111827;
        border-color: #facc15;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .checkbox-button input[type="checkbox"],
    .checkbox-button input[type="radio"] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
    }

    @media print {
      body, main, .container {
        background: white !important; color: black !important; margin: 0 !important; padding: 0 !important; max-width: 100% !important; font-family: serif !important; font-size: 12pt !important;
      }
      header, form, button, .print\:hidden {
        display: none !important;
      }
      .summary-print-container {
        box-shadow: none !important; padding: 0 !important; margin: 0 0 1rem 0 !important; background: transparent !important; border: none !important;
      }
      table {
        width: 100% !important; border-collapse: collapse !important; font-size: 10pt !important; color: black !important;
      }
      thead, tbody, tr, th, td {
        border: 1px solid black !important; padding: 2px 4px !important; background: transparent !important;
      }
      th { font-weight: bold !important; background: #eee !important; }
      tr { page-break-inside: avoid; }
      div, p, h1, h2, h3, h4, h5, h6 { margin: 0 !important; padding: 0 !important; }
      h1, h2 { font-weight: bold !important; margin-bottom: 0.3em !important; }
      .hide-on-print {
        display: none !important;
      }
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200">
  <main id="root" class="p-4"></main>

  <script type="module">
    const { useState, useEffect, useMemo, createElement, Fragment } = window.React;
    const ReactDOM = window.ReactDOM;
    const firebase = window.firebase; 

    // CHANGE THIS TO YOUR ACTUAL UPI ID
    const BUSINESS_UPI_ID = "kalpanamoorthy13-1@okicici"; 
    const BUSINESS_NAME = "Possible Studio";
    const ADMIN_PASSWORD = "1122";
    
    const firebaseConfig = {
      apiKey: "AIzaSyAIHIVv6dJ0LlNqP_0qkYNok7xsbxHgdRY",
      authDomain: "studio-space-rental-database.firebaseapp.com",
      databaseURL: "https://studio-space-rental-database-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "studio-space-rental-database",
      storageBucket: "studio-space-rental-database.appspot.com",
      messagingSenderId: "176375720882",
      appId: "1:176375720882:web:ac012e2d33e8fec5ca52ab",
      measurementId: "G-NWZ18H2CVT"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const rentalsRef = database.ref('rentals');
    const rentalsQuery = rentalsRef.orderByChild('timestamp');

    function getTodayDateString() {
      const today = new Date();
      const offset = today.getTimezoneOffset();
      const todayLocal = new Date(today.getTime() - offset * 60 * 1000);
      return todayLocal.toISOString().split('T')[0];
    }

    function getNextDayDateString(dateString) {
        const date = new Date(dateString);
        date.setDate(date.getDate() + 1);
        return date.toISOString().split('T')[0];
    }

    function formatDateToMonthDay(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const options = { month: 'short', day: 'numeric', timeZone: 'UTC' };
        return date.toLocaleDateString('en-US', options).toUpperCase();
    }

    function formatTimeTo12Hour(timeString) {
        if (!timeString) return '';
        const [hours, minutes] = timeString.split(':');
        const date = new Date();
        date.setHours(parseInt(hours), parseInt(minutes));
        const options = { hour: 'numeric', minute: '2-digit', hour12: true };
        return date.toLocaleTimeString('en-US', options);
    }
    
    const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const PAYMENT_METHODS = ['UPI', 'Cash', 'Cards'];

    function LoadingSpinner() {
      return createElement('div', { className: "flex flex-col items-center justify-center gap-2" },
        createElement('div', { className: "w-12 h-12 rounded-full animate-spin border-4 border-solid border-yellow-400 border-t-transparent", role: "status", "aria-label": "loading" }),
        createElement('p', { className: "text-gray-400" }, "Loading Bookings...")
      );
    }

    function LoginModal({ isOpen, onClose, onLogin }) {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      useEffect(() => { setPassword(''); setError(''); }, [isOpen]);
      if (!isOpen) return null;
      
      function handleSubmit(e) {
        e.preventDefault();
        if (!onLogin(password)) { setError('Invalid password.'); setPassword(''); }
      }

      return createElement('div', { className: "fixed inset-0 bg-black/70 flex items-center justify-center z-50", onClick: onClose },
        createElement('div', { className: "bg-gray-900 p-8 rounded-xl shadow-lg ring-1 ring-yellow-400/50 w-full max-w-sm m-4", onClick: e => e.stopPropagation() },
          createElement('h2', { className: "text-2xl font-bold text-white mb-4" }, "Admin Login"),
          createElement('form', { onSubmit: handleSubmit },
            createElement('input', { type: "password", className: "w-full px-4 py-3 bg-gray-800 border border-gray-600 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400 mb-4", placeholder: "Enter password", value: password, onChange: e => setPassword(e.target.value), autoFocus: true }),
            error && createElement('p', { className: "text-red-400 text-center mb-4" }, error),
            createElement('button', { type: "submit", className: "w-full bg-yellow-400 text-black font-bold py-3 rounded-lg hover:bg-yellow-500" }, "Login")
          )
        )
      );
    }

    function ConfirmModal({ isOpen, onClose, onConfirm, title, message }) {
        if (!isOpen) return null;
        return createElement('div', { className: "fixed inset-0 bg-black/70 flex items-center justify-center z-50", onClick: onClose },
            createElement('div', { className: "bg-gray-900 p-8 rounded-xl shadow-lg ring-1 ring-red-500/50 w-full max-w-md m-4", onClick: e => e.stopPropagation() },
                createElement('h2', { className: "text-2xl font-bold text-white mb-4" }, title),
                createElement('p', { className: "text-gray-300 mb-6" }, message),
                createElement('div', { className: "flex justify-end gap-4" },
                    createElement('button', { onClick: onClose, className: "px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors" }, "Cancel"),
                    createElement('button', { onClick: onConfirm, className: "px-4 py-2 rounded-md bg-red-600 text-white font-bold hover:bg-red-700 transition-colors" }, "Confirm Delete")
                )
            )
        );
    }

    function QRModal({ isOpen, onClose, onMarkPaid, booking }) {
        if (!isOpen || !booking) return null;
        
        const balance = (booking.totalAmount || 0) - (booking.paidAmount || 0);
        
        // Generate Preloaded UPI Link
        // Format: upi://pay?pa=ID&pn=NAME&am=AMOUNT&cu=INR
        const upiLink = `upi://pay?pa=${BUSINESS_UPI_ID}&pn=${encodeURIComponent(BUSINESS_NAME)}&am=${balance}&cu=INR`;
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upiLink)}`;

        return createElement('div', { className: "fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4", onClick: onClose },
            createElement('div', { className: "bg-white p-6 rounded-2xl shadow-2xl w-full max-w-xs text-center relative", onClick: e => e.stopPropagation() },
                createElement('button', { onClick: onClose, className: "absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600" }, 
                    createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, createElement('path', { d: "M18 6L6 18M6 6l12 12" }))
                ),
                createElement('h3', { className: "text-gray-900 font-bold text-lg mb-1" }, booking.clientName),
                createElement('p', { className: "text-red-600 font-bold text-xl mb-4" }, `Amount Due: ₹${balance.toLocaleString()}`),
                
                createElement('div', { className: "bg-gray-50 p-4 rounded-xl mb-6 flex flex-col justify-center items-center border border-gray-100" },
                    createElement('img', { 
                        src: qrUrl, 
                        alt: "Payment QR Code",
                        className: "w-48 h-48 rounded-md shadow-sm mb-2",
                        onError: (e) => { e.target.src = "https://placehold.co/400x400/facc15/000000?text=QR+Error"; }
                    }),
                    createElement('p', { className: "text-[10px] text-gray-400 uppercase tracking-widest font-bold" }, "Scan to Pay with UPI")
                ),
                
                createElement('button', { 
                    onClick: () => { 
                        onMarkPaid(booking.id, booking.totalAmount); 
                        onClose(); 
                    },
                    className: "w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors shadow-md flex items-center justify-center gap-2" 
                }, 
                    createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "3" }, createElement('polyline', { points: "20 6 9 17 4 12" })),
                    "Paid"
                )
            )
        );
    }

    function RentalForm({ rentalToEdit, onSubmitSuccess, onCancel }) {
      const getInitialFormData = () => ({
          clientName: '',
          bookingSegments: [{ date: getTodayDateString(), startTime: '10:00', endTime: '18:00', approxHours: '' }],
          bookingType: 'spaceRental',
          isFlexibleShoot: false,
          markUnavailable: false,
          location: '',
          withEquipment: false,
          hasCamera: false,
          cameras: 1,
          mic: false,
          micType: [],
          lights: false,
          note: '',
          paidAmount: '',
          totalAmount: '',
          paymentStatus: 'paid', 
          paymentMethod: 'UPI',
          withEditing: false,
          editPaymentAmount: '',
          editPaymentMethod: 'UPI',
      });

      const [formData, setFormData] = useState(getInitialFormData);
      const [isSubmitting, setIsSubmitting] = useState(false);
      const [error, setError] = useState('');

      useEffect(() => {
          if (rentalToEdit) {
              const formatAmount = (amount) => (amount === 0 || amount === null || amount === undefined) ? '' : amount;
              let bookingType = 'spaceRental';
              if (rentalToEdit.isPossibleStudioShoot) bookingType = 'possibleStudio';
              else if (rentalToEdit.isInHouseClient) bookingType = 'inHouse';
              else if (rentalToEdit.isOutside) bookingType = 'outside';

              let paymentStatus = 'paid';
              if (rentalToEdit.isAdvance) {
                  if (Number(rentalToEdit.paidAmount) === 0) paymentStatus = 'pending';
                  else paymentStatus = 'advance';
              }

              setFormData({
                  clientName: rentalToEdit.clientName || '',
                  bookingSegments: (rentalToEdit.bookingSegments && rentalToEdit.bookingSegments.length > 0) 
                      ? rentalToEdit.bookingSegments 
                      : [{ date: rentalToEdit.date, startTime: rentalToEdit.startTime, endTime: rentalToEdit.endTime, approxHours: rentalToEdit.approxHours || '' }],
                  bookingType: bookingType,
                  isFlexibleShoot: rentalToEdit.isFlexibleShoot || false,
                  markUnavailable: rentalToEdit.markUnavailable || false,
                  location: rentalToEdit.location || '',
                  withEquipment: rentalToEdit.withEquipment || false,
                  hasCamera: rentalToEdit.hasCamera || false,
                  cameras: rentalToEdit.cameras || 1,
                  mic: rentalToEdit.mic || false,
                  micType: rentalToEdit.micType || [],
                  lights: rentalToEdit.lights || false,
                  note: rentalToEdit.note || '',
                  paidAmount: formatAmount(rentalToEdit.paidAmount),
                  totalAmount: formatAmount(rentalToEdit.totalAmount),
                  paymentStatus: paymentStatus,
                  paymentMethod: rentalToEdit.paymentMethod || 'UPI',
                  withEditing: rentalToEdit.withEditing || false,
                  editPaymentAmount: formatAmount(rentalToEdit.editPaymentAmount),
                  editPaymentMethod: rentalToEdit.editPaymentMethod || 'UPI',
              });
          } else {
              setFormData(getInitialFormData());
          }
          setError('');
      }, [rentalToEdit]);

      function handleChange(e) {
        const { name, value, type, checked } = e.target;
        const val = type === 'checkbox' ? checked : value;

        setFormData(fd => {
            let newFd = { ...fd };
            if (name === 'micType') {
                const currentMicTypes = newFd.micType || [];
                newFd.micType = checked ? [...currentMicTypes, value] : currentMicTypes.filter(type => type !== value);
            } else if (name === 'bookingType') {
                newFd.bookingType = value;
                if (value !== 'outside') newFd.location = '';
            } else {
                newFd[name] = val;
            }

            if (name === 'isFlexibleShoot' && !checked) {
                newFd.markUnavailable = false;
            }
            if (name === 'withEquipment' && !checked) {
                newFd = { ...newFd, hasCamera: false, cameras: 1, mic: false, micType: [], lights: false };
            }
            if (name === 'withEditing' && !checked) {
                newFd = { ...newFd, editPaymentAmount: '', editPaymentMethod: 'UPI' };
            }

            const applySpecialRules = newFd.bookingType === 'inHouse' || newFd.bookingType === 'possibleStudio';
            if (applySpecialRules) {
                newFd = {
                    ...newFd,
                    paidAmount: '', totalAmount: '', paymentStatus: 'paid', paymentMethod: 'UPI',
                    withEditing: false, editPaymentAmount: '',
                    bookingSegments: newFd.bookingSegments.map(segment => ({ ...segment, endTime: '' }))
                };
            }
            return newFd;
        });
      }

      function handleSegmentChange(index, field, value) {
          setFormData(fd => {
              const newSegments = [...fd.bookingSegments];
              newSegments[index] = { ...newSegments[index], [field]: value };
              return { ...fd, bookingSegments: newSegments };
          });
      }

      function handleAddNextDate() {
          setFormData(fd => {
              const lastSegment = fd.bookingSegments[fd.bookingSegments.length - 1];
              const nextDate = getNextDayDateString(lastSegment.date);
              const newSegment = { date: nextDate, startTime: lastSegment.startTime, endTime: lastSegment.endTime, approxHours: lastSegment.approxHours };
              return { ...fd, bookingSegments: [...fd.bookingSegments, newSegment] };
          });
      }

      function handleRemoveSegment(index) {
          setFormData(fd => {
              const newSegments = fd.bookingSegments.filter((_, i) => i !== index);
              return { ...fd, bookingSegments: newSegments.length > 0 ? newSegments : [getInitialFormData().bookingSegments[0]] };
          });
      }

      async function handleSubmit(e) {
        e.preventDefault();
        setError('');
        if (!formData.clientName) return setError("Client Name is required.");
        
        const isSpecialBooking = formData.bookingType === 'inHouse' || formData.bookingType === 'possibleStudio';
        for (const segment of formData.bookingSegments) {
            if (!segment.date || !segment.startTime) return setError("Date and Start Time are required.");
            if (!isSpecialBooking && !formData.isFlexibleShoot && !segment.endTime) return setError("End Time is required.");
            if (!isSpecialBooking && formData.isFlexibleShoot && !segment.approxHours) return setError("Approx. Hours are required for flexible shoots.");
            if (!isSpecialBooking && !formData.isFlexibleShoot && segment.startTime >= segment.endTime) return setError("End Time must be after Start Time.");
        }

        setIsSubmitting(true);
        try {
            let finalPaid = Number(formData.paidAmount) || 0;
            let finalTotal = Number(formData.totalAmount) || 0;
            let finalIsAdvance = formData.paymentStatus !== 'paid';

            if (formData.paymentStatus === 'paid') {
                finalTotal = finalPaid;
            } else if (formData.paymentStatus === 'pending') {
                finalTotal = finalPaid; 
                finalPaid = 0;
            }

            const dataToSave = { 
                ...formData,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                paidAmount: finalPaid,
                totalAmount: finalTotal,
                isAdvance: finalIsAdvance,
                editPaymentAmount: Number(formData.editPaymentAmount) || 0,
                cameras: formData.hasCamera ? (Number(formData.cameras) || 1) : 0,
                isPossibleStudioShoot: formData.bookingType === 'possibleStudio',
                isInHouseClient: formData.bookingType === 'inHouse',
                isOutside: formData.bookingType === 'outside',
            };
            
            delete dataToSave.bookingType;
            delete dataToSave.paymentStatus;

            if (isSpecialBooking) {
                dataToSave.paidAmount = 0; dataToSave.isAdvance = false; dataToSave.totalAmount = 0;
                dataToSave.bookingSegments = dataToSave.bookingSegments.map(segment => ({ ...segment, endTime: '' }));
            }

            if (rentalToEdit && rentalToEdit.id) {
                await rentalsRef.child(rentalToEdit.id).update(dataToSave);
            } else {
                await rentalsRef.push(dataToSave);
            }
            onSubmitSuccess(rentalToEdit ? "Updated successfully" : "Added successfully");
        } catch (err) {
            setError("Error saving data.");
            console.error(err);
        } finally {
            setIsSubmitting(false);
        }
      }
      
      const isEditing = !!(rentalToEdit && rentalToEdit.id);
      const inputClasses = "w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 outline-none transition-colors";
      const labelClasses = "block text-sm font-medium text-gray-300 mb-1";
      const checkboxLabelClasses = "flex items-center space-x-3 text-white cursor-pointer";
      const checkboxClasses = "h-5 w-5 rounded bg-gray-700 border-gray-500 text-yellow-400 focus:ring-yellow-400 cursor-pointer";
      const applySpecialRules = formData.bookingType === 'inHouse' || formData.bookingType === 'possibleStudio';

      return createElement('div', { className: "bg-gray-900 p-6 md:p-8 rounded-xl shadow-lg ring-1 ring-gray-800 print:hidden mb-8" },
        createElement('h2', { className: "text-2xl font-bold mb-6 text-yellow-400" }, isEditing ? "Edit Booking" : "New Studio Booking"),
        error && createElement('div', { className: "bg-red-900/50 px-4 py-3 rounded mb-4 text-red-300" }, error),
        createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
          createElement('div', { className: "flex flex-wrap gap-3 mb-4" },
            ['spaceRental', 'possibleStudio', 'inHouse', 'outside'].map(type => 
              createElement('label', { key: type, className: `checkbox-button ${formData.bookingType === type ? 'checked' : ''}` },
                createElement('input', { type: "radio", name: "bookingType", value: type, checked: formData.bookingType === type, onChange: handleChange }),
                createElement('span', null, type === 'spaceRental' ? "Space Rental" : type === 'possibleStudio' ? "Possible Studio" : type === 'inHouse' ? "InHouse" : "Outside")
              )
            )
          ),
          
          createElement('div', { className: `form-section ${formData.bookingType === 'outside' ? 'open' : ''}` },
            createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700 mt-4" },
              createElement('label', { htmlFor: "location", className: labelClasses }, "Location"),
              createElement('input', { id: "location", name: "location", type: "text", className: inputClasses, value: formData.location, onChange: handleChange })
            )
          ),

          createElement('div', null,
            createElement('label', { htmlFor: "clientName", className: labelClasses }, "Client Name"),
            createElement('input', { id: "clientName", name: "clientName", type: "text", className: inputClasses, value: formData.clientName, onChange: handleChange, required: true })
          ),

          createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700" },
             createElement('div', { className: "flex flex-col gap-2" },
                createElement('label', { className: checkboxLabelClasses },
                    createElement('input', { type: "checkbox", name: "isFlexibleShoot", className: checkboxClasses, checked: formData.isFlexibleShoot, onChange: handleChange }),
                    createElement('span', null, "Flexible / Full Day Shoot (Approx. hours)")
                ),
                formData.isFlexibleShoot && createElement('label', { className: "flex items-center space-x-3 text-red-400 cursor-pointer ml-6" },
                    createElement('input', { type: "checkbox", name: "markUnavailable", className: checkboxClasses, checked: formData.markUnavailable, onChange: handleChange }),
                    createElement('span', null, "Mark as Not Available for other shoots")
                )
             )
          ),

          createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700 space-y-4" },
            createElement('h3', { className: "text-lg font-semibold text-gray-200" }, "Booking Dates & Times"),
            formData.bookingSegments.map((segment, index) => (
              createElement('div', { key: index, className: "grid grid-cols-1 md:grid-cols-3 gap-4 items-end border-t border-gray-700 pt-4 first:border-t-0 first:pt-0" },
                createElement('div', null,
                  createElement('label', { htmlFor: `date-${index}`, className: labelClasses }, `Date ${index + 1}`),
                  createElement('input', { id: `date-${index}`, type: "date", className: inputClasses, value: segment.date, onChange: (e) => handleSegmentChange(index, 'date', e.target.value), required: true })
                ),
                createElement('div', null,
                  createElement('label', { htmlFor: `startTime-${index}`, className: labelClasses }, `Start Time ${index + 1}`),
                  createElement('input', { id: `startTime-${index}`, type: "time", className: inputClasses, value: segment.startTime, onChange: (e) => handleSegmentChange(index, 'startTime', e.target.value), required: true })
                ),
                createElement('div', { className: "flex items-center gap-2" },
                    !applySpecialRules && !formData.isFlexibleShoot && createElement('div', { className: "flex-grow" },
                        createElement('label', { className: labelClasses }, "End Time"),
                        createElement('input', { type: "time", className: inputClasses, value: segment.endTime, onChange: (e) => handleSegmentChange(index, 'endTime', e.target.value), required: true })
                    ),
                    !applySpecialRules && formData.isFlexibleShoot && createElement('div', { className: "flex-grow" },
                        createElement('label', { className: labelClasses }, "Approx Hours"),
                        createElement('input', { type: "number", min: "1", step: "0.5", className: inputClasses, value: segment.approxHours || '', onChange: (e) => handleSegmentChange(index, 'approxHours', e.target.value), placeholder: "e.g. 6.5", required: true })
                    ),
                    index > 0 && createElement('button', { type: "button", onClick: () => handleRemoveSegment(index), className: "p-2 bg-red-600 text-white rounded-md hover:bg-red-700" }, 
                        createElement('svg', {xmlns:"http://www.w3.org/2000/svg", fill:"none", viewBox:"0 0 24 24", strokeWidth:"1.5", stroke:"currentColor", className:"w-5 h-5"}, createElement('path', {strokeLinecap:"round", strokeLinejoin:"round", d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.925a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.166m7.452-1.044L12 12m0 0l-1.125-1.5M12 12l1.125-1.5m-1.125 1.5L12 12m-2.25 4.5h4.5"}))
                    )
                )
              )
            )),
            createElement('button', { type: "button", onClick: handleAddNextDate, className: "mt-4 w-full bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600 flex items-center justify-center gap-2" },
              createElement('svg', {xmlns:"http://www.w3.org/2000/svg", fill:"none", viewBox:"0 0 24 24", strokeWidth:2, stroke:"currentColor", className:"w-5 h-5"}, createElement('path', {strokeLinecap:"round", strokeLinejoin:"round", d:"M12 4.5v15m7.5-7.5h-15"})),
              "Add Next Date"
            )
          ),

          createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700 space-y-4" },
            createElement('div', { className: "flex flex-wrap gap-4" },
              createElement('label', { className: checkboxLabelClasses },
                createElement('input', { type: "checkbox", name: "withEquipment", className: checkboxClasses, checked: formData.withEquipment, onChange: handleChange }),
                createElement('span', null, "With Equipment")
              ),
              !applySpecialRules && createElement('label', { className: checkboxLabelClasses },
                createElement('input', { type: "checkbox", name: "withEditing", className: checkboxClasses, checked: formData.withEditing, onChange: handleChange }),
                createElement('span', null, "With Editing")
              )
            ),
            createElement('div', { className: `pl-4 ml-2 border-l-2 border-yellow-400/50 form-section ${formData.withEquipment ? 'open' : ''}` },
              createElement('div', { className: "mt-4 space-y-4" },
                createElement('div', null,
                  createElement('label', { className: checkboxLabelClasses },
                    createElement('input', { type: "checkbox", name: "hasCamera", className: checkboxClasses, checked: formData.hasCamera, onChange: handleChange }),
                    createElement('span', null, "Camera")
                  )
                ),
                formData.hasCamera && createElement('div', null,
                  createElement('label', { htmlFor: "cameras", className: labelClasses }, "No. of Cameras"),
                  createElement('input', { id: "cameras", name: "cameras", type: "number", min: "1", className: inputClasses, value: formData.cameras, onChange: handleChange })
                ),
                createElement('div', null,
                  createElement('label', { className: checkboxLabelClasses },
                    createElement('input', { type: "checkbox", name: "mic", className: checkboxClasses, checked: formData.mic, onChange: handleChange }),
                    createElement('span', null, "Mic")
                  )
                ),
                formData.mic && createElement('div', { className: "mt-2 ml-6 space-y-2" },
                  createElement('label', { className: checkboxLabelClasses },
                    createElement('input', { type: "checkbox", name: "micType", value: "SHURE", className: checkboxClasses, checked: formData.micType.includes("SHURE"), onChange: handleChange }),
                    createElement('span', null, "SHURE")
                  ),
                  createElement('label', { className: checkboxLabelClasses },
                    createElement('input', { type: "checkbox", name: "micType", value: "DJI wireless", className: checkboxClasses, checked: formData.micType.includes("DJI wireless"), onChange: handleChange }),
                    createElement('span', null, "DJI wireless")
                  )
                ),
                createElement('div', null,
                  createElement('label', { className: checkboxLabelClasses },
                    createElement('input', { type: "checkbox", name: "lights", className: checkboxClasses, checked: formData.lights, onChange: handleChange }),
                    createElement('span', null, "Lights")
                  )
                )
              )
            )
          ),
          
          !applySpecialRules && createElement('div', { className: "p-3 bg-gray-800/50 rounded-lg border border-gray-700 space-y-4" },
            createElement('div', { className: "flex flex-wrap gap-3" },
              ['advance', 'pending', 'paid'].map(status => 
                createElement('label', { key: status, className: `checkbox-button flex-1 text-xs sm:text-sm ${formData.paymentStatus === status ? 'checked' : ''}` },
                  createElement('input', { type: "radio", name: "paymentStatus", value: status, checked: formData.paymentStatus === status, onChange: handleChange }),
                  createElement('span', null, status === 'advance' ? "Advance" : status === 'pending' ? "Have to Pay" : "Paid")
                )
              )
            ),
            createElement('div', { className: `grid grid-cols-1 ${formData.paymentStatus !== 'pending' ? 'md:grid-cols-2' : ''} gap-4` },
              createElement('div', null,
                createElement('label', { className: labelClasses }, formData.paymentStatus === 'pending' ? "Pending Amount (₹)" : "Amount (₹)"),
                createElement('input', { name: "paidAmount", type: "number", step: "0.01", min: "0", className: inputClasses, value: formData.paidAmount, onChange: handleChange })
              ),
              formData.paymentStatus !== 'pending' && createElement('div', null,
                createElement('label', { className: labelClasses }, "Payment Method"),
                createElement('select', { name: "paymentMethod", className: inputClasses, value: formData.paymentMethod, onChange: handleChange },
                  PAYMENT_METHODS.map(m => createElement('option', { key: m, value: m }, m))
                )
              )
            ),
            formData.paymentStatus === 'advance' && createElement('div', { className: "mt-4" },
              createElement('label', { className: labelClasses }, "Total Amount (₹)"),
              createElement('input', { name: "totalAmount", type: "number", step: "0.01", className: inputClasses, value: formData.totalAmount, onChange: handleChange })
            )
          ),

          createElement('div', null,
            createElement('label', { className: labelClasses }, "Note"),
            createElement('textarea', { name: "note", rows: 2, className: inputClasses, value: formData.note, onChange: handleChange })
          ),
          createElement('div', { className: "flex justify-end space-x-3 pt-4" },
            createElement('button', { type: "button", onClick: onCancel, className: "px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500" }, "Cancel"),
            createElement('button', { type: "submit", disabled: isSubmitting, className: "px-4 py-2 rounded-md bg-yellow-400 text-black font-bold hover:bg-yellow-500 disabled:opacity-50" },
              isSubmitting ? "Saving..." : (isEditing ? "Update" : "Add Booking"))
          )
        )
      );
    }
    
    function RentalList({ title, rentals, isAdmin, onEdit, onRequestDelete, onRequestQR, isTodayList = false, className = "" }) {
      if (!rentals.length) {
          if (!title) return null;
          return createElement("div", { className: `mb-12 ${className}` },
              createElement('h2', { className: "text-3xl font-bold text-yellow-400 border-b-2 border-gray-700 pb-2 mb-6" }, title),
              createElement("div", { className: "text-center py-10 bg-gray-900 rounded-lg border border-dashed border-gray-700 text-gray-400" }, "No bookings found.")
          );
      }

      return createElement("div", { className: `mb-12 ${className}` },
        title && createElement('h2', { className: "text-3xl font-bold text-yellow-400 border-b-2 border-gray-700 pb-2 mb-6" }, title),
        createElement("div", { className: "bg-gray-900 rounded-xl shadow-lg ring-1 ring-gray-800 overflow-hidden" },
          createElement("div", { className: "overflow-x-auto" },
            createElement("table", { className: "w-full text-sm text-left text-gray-400" },
              createElement("thead", { className: "text-xs text-gray-300 uppercase bg-gray-800" },
                createElement("tr", null,
                  ["Client", "Date", "Time", "Details", "Payment", "Notes"].map(h => createElement("th", { key: h, className: "px-6 py-3" }, h)),
                  isAdmin && createElement("th", { className: "px-6 py-3 print:hidden text-right" }, "Actions")
                )
              ),
              createElement("tbody", null,
                rentals.map(r =>
                  createElement("tr", { key: r.id + (r.bookingSegments[0]?.date || ''), className: "border-b border-gray-800 hover:bg-gray-800/50" },
                    createElement("td", { className: "px-6 py-4 font-medium text-white" }, r.clientName || "-"),
                    createElement("td", { className: "px-6 py-4" }, r.bookingSegments?.map((s, idx) => createElement('div', { key: idx, className: "text-xs" }, formatDateToMonthDay(s.date)))),
                    createElement("td", { className: "px-6 py-4" }, 
                      r.bookingSegments?.map((s, idx) => {
                          let timeStr = formatTimeTo12Hour(s.startTime);
                          if (r.isFlexibleShoot) {
                              timeStr += ` (Approx ${s.approxHours}h)`;
                              if (r.markUnavailable) timeStr += " - ⛔ BLOCKED";
                              else timeStr += " - Flexible";
                          }
                          else if (s.endTime && !(r.isInHouseClient || r.isPossibleStudioShoot)) timeStr += ` - ${formatTimeTo12Hour(s.endTime)}`;
                          return createElement('div', { key: idx, className: "text-xs" }, timeStr);
                      })
                    ),
                    createElement("td", { className: "px-6 py-4" },
                      createElement('div', { className: "flex flex-col gap-1" },
                        r.isOutside ? createElement('span', null, r.location) : createElement('span', { className: "font-semibold" }, 'In Studio'),
                        r.withEquipment && createElement('span', { className: "text-xs text-gray-500" }, 
                          [
                            r.hasCamera && r.cameras > 0 && `${r.cameras} cam`,
                            r.mic && (r.micType && r.micType.length > 0 ? `mic (${r.micType.join(' / ')})` : `mic`),
                            r.lights && `lights`
                          ].filter(Boolean).join(' | ') || "Equip. included"
                        )
                      )
                    ),
                    createElement("td", { className: "px-6 py-4" },
                      r.isInHouseClient ? createElement('span', { className: "text-blue-300" }, "InHouse") :
                      r.isPossibleStudioShoot ? createElement('span', { className: "text-purple-300" }, "Possible") :
                      createElement('div', { className: "flex flex-col group" },
                        (() => {
                            if (r.isAdvance) {
                                if (!r.totalAmount || Number(r.totalAmount) === 0) {
                                    return createElement('div', { className: "flex items-center gap-2" },
                                        createElement('span', { className: "font-semibold text-yellow-400" }, r.paidAmount > 0 ? `Adv: ₹${r.paidAmount?.toLocaleString() ?? "0"}` : `Unpaid`),
                                        isAdmin && createElement('button', { 
                                            onClick: () => onRequestQR(r), 
                                            className: "p-1 bg-yellow-400/10 text-yellow-400 rounded hover:bg-yellow-400/20 print:hidden transition-colors",
                                            title: "Show Payment QR"
                                        }, 
                                            createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, createElement('rect', { x: "3", y: "3", width: "18", height: "18", rx: "2" }), createElement('path', { d: "M7 7h2v2H7zM15 7h2v2h-2zM7 15h2v2H7zM15 15h2v2h-2z" }))
                                        )
                                    );
                                }
                                const balance = (r.totalAmount || 0) - (r.paidAmount || 0);
                                if (balance > 0) {
                                    return createElement('div', { className: "flex items-center gap-2" },
                                        createElement('span', { className: "text-red-400 font-semibold" }, `Pending: ₹${balance.toLocaleString()}`),
                                        isAdmin && createElement('button', { 
                                            onClick: () => onRequestQR(r), 
                                            className: "p-1 bg-red-400/10 text-red-400 rounded hover:bg-red-400/20 print:hidden transition-colors",
                                            title: "Show Payment QR"
                                        }, 
                                            createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" }, createElement('rect', { x: "3", y: "3", width: "18", height: "18", rx: "2" }), createElement('path', { d: "M7 7h2v2H7zM15 7h2v2h-2zM7 15h2v2H7zM15 15h2v2h-2z" }))
                                        )
                                    );
                                } else {
                                    return createElement('span', { className: "text-green-400 font-semibold" }, `Paid: ₹${r.totalAmount?.toLocaleString() ?? "0"}`);
                                }
                            }
                            return createElement('span', { className: "font-semibold text-yellow-400" }, `₹${r.paidAmount?.toLocaleString() ?? "0"}`);
                        })(),
                        createElement('span', { className: "text-xs text-gray-500" }, 
                           `${r.paymentMethod || ''}` + 
                           (r.isAdvance && r.totalAmount > 0 && r.paidAmount > 0 ? ` (Adv: ₹${r.paidAmount?.toLocaleString() ?? "0"})` : '')
                        )
                      )
                    ),
                    createElement("td", { className: "px-6 py-4 italic text-gray-500" }, r.note || "-"),
                    isAdmin && createElement("td", { className: "px-6 py-4 print:hidden text-right" },
                      createElement("div", { className: "flex items-center justify-end space-x-1" },
                        createElement("button", { onClick: () => onEdit(r), className: "p-2 text-yellow-400 hover:bg-yellow-400/20 rounded-full" }, createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, createElement("path", { d: "M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" }))),
                        createElement("button", { onClick: () => onRequestDelete(r.id), className: "p-2 text-red-500 hover:bg-red-500/20 rounded-full" }, createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, createElement("path", { d: "M3 6h18" }), createElement("path", { d: "M19 6v14a2 2 0 0 1-2 2H7a2 0 0 1-2-2V6m3 0V4a2 0 0 1 2-2h4a2 0 0 1 2 2v2" })))
                      )
                    )
                  )
                )
              )
            )
          )
        )
      );
    }
    
    function Summary({ rentals }) {
      const stats = useMemo(() => {
          const unique = Array.from(new Map(rentals.map(r => [r.id, r])).values());
          const rev = unique.reduce((a, e) => a + (Number(e.paidAmount) || 0) + (e.withEditing ? (Number(e.editPaymentAmount) || 0) : 0), 0);
          return { revenue: rev, count: unique.length };
      }, [rentals]);

      return createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 text-center" },
        createElement("div", { className: "bg-gray-800/50 p-4 rounded-lg ring-1 ring-gray-700" },
          createElement("p", { className: "text-sm text-yellow-400 font-semibold" }, "Total Revenue"),
          createElement("p", { className: "text-2xl font-bold text-white mt-1" }, `₹${stats.revenue.toLocaleString()}`)
        ),
        createElement("div", { className: "bg-gray-800/50 p-4 rounded-lg ring-1 ring-gray-700" },
          createElement("p", { className: "text-sm text-yellow-400 font-semibold" }, "Total Unique Bookings"),
          createElement("p", { className: "text-2xl font-bold text-white mt-1" }, stats.count)
        )
      );
    }

    function App() {
      const [isAdmin, setIsAdmin] = useState(false);
      const [showLogin, setShowLogin] = useState(false);
      const [showForm, setShowForm] = useState(false);
      const [bookings, setBookings] = useState([]);
      const [editBooking, setEditBooking] = useState(null);
      const [loading, setLoading] = useState(true);
      const [selectedMonth, setSelectedMonth] = useState(String(new Date().getMonth() + 1));
      const [selectedYear, setSelectedYear] = useState(String(new Date().getFullYear()));
      const [successMsg, setSuccessMsg] = useState('');
      const [bookingToDelete, setBookingToDelete] = useState(null);
      const [qrBooking, setQrBooking] = useState(null);
      const [currentTime, setCurrentTime] = useState(new Date());
      const [error, setError] = useState('');

      useEffect(() => {
        const timer = setInterval(() => setCurrentTime(new Date()), 60000);
        return () => clearInterval(timer);
      }, []);

      useEffect(() => {
        const onDataChange = snapshot => {
          const arr = [];
          snapshot.forEach(child => {
            const val = child.val();
            if (val) {
              arr.push({ id: child.key, ...val });
            }
          });
          setBookings(arr);
          setLoading(false);
        };
        const onError = err => { setError("Failed to load bookings."); setLoading(false); console.error(err); };
        
        rentalsQuery.on('value', onDataChange, onError);
        return () => rentalsQuery.off('value', onDataChange);
      }, []);

      function displayMessage(setter, msg) {
        setter(msg);
        setTimeout(() => setter(""), 3000);
      }

      function doLogin(pwd) {
        if (pwd === ADMIN_PASSWORD) { setIsAdmin(true); setShowLogin(false); return true; }
        return false;
      }

      function doLogout() {
        setIsAdmin(false);
        setEditBooking(null);
        setShowForm(false);
      }

      function handleRequestDelete(id) {
          setBookingToDelete(id);
      }
      
      async function handleConfirmDelete() {
          if (!bookingToDelete) return;
          try {
              await rentalsRef.child(bookingToDelete).remove();
              displayMessage(setSuccessMsg, "Booking deleted successfully.");
          } catch (e) {
              displayMessage(setError, "Delete failed. Please try again.");
              console.error(e);
          } finally {
              setBookingToDelete(null);
          }
      }

      async function handleMarkAsPaid(bookingId, totalAmount) {
          try {
              await rentalsRef.child(bookingId).update({
                  isAdvance: false,
                  paidAmount: Number(totalAmount) || 0,
                  paymentMethod: 'UPI' 
              });
              displayMessage(setSuccessMsg, "Payment status updated to Paid.");
          } catch (e) {
              displayMessage(setError, "Failed to update payment.");
              console.error(e);
          }
      }

      function handleEdit(booking) {
        const originalBooking = bookings.find(b => b.id === booking.id);
        setEditBooking(originalBooking);
        setShowForm(true);
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      
      function handleAddNewClick() {
        setEditBooking(null);
        setShowForm(true);
      }
      
      function handleCancelForm() {
        setEditBooking(null);
        setShowForm(false);
      }

      function handleSuccess(msg) {
        displayMessage(setSuccessMsg, msg);
        setEditBooking(null);
        setShowForm(false);
      }

      const { todaysBookings, upcomingBookings, pastBookings } = useMemo(() => {
        const now = currentTime;
        const todayStr = getTodayDateString();
        
        const allUpcoming = [];
        const allTodays = [];
        const allPast = [];

        bookings.forEach(booking => {
            if (!booking.bookingSegments || booking.bookingSegments.length === 0) return;

            booking.bookingSegments.forEach((segment, index) => {
                const singleShootBooking = {
                    ...booking,
                    bookingSegments: [segment],
                    isLastSegment: index === booking.bookingSegments.length - 1
                };

                let endDateTime;
                const isSpecialBooking = singleShootBooking.isInHouseClient || singleShootBooking.isPossibleStudioShoot || singleShootBooking.isFlexibleShoot;

                if (isSpecialBooking || !segment.endTime) {
                    endDateTime = new Date(segment.date);
                    endDateTime.setHours(23, 59, 59, 999);
                } else {
                    endDateTime = new Date(`${segment.date}T${segment.endTime}`);
                }

                if (now > endDateTime) {
                    allPast.push(singleShootBooking);
                } else if (segment.date === todayStr) {
                    allTodays.push(singleShootBooking);
                } else {
                    allUpcoming.push(singleShootBooking);
                }
            });
        });

        const sortAsc = (a, b) => (a.bookingSegments[0].date + a.bookingSegments[0].startTime).localeCompare(b.bookingSegments[0].date + b.bookingSegments[0].startTime);
        const sortDesc = (a, b) => (b.bookingSegments[0].date + b.bookingSegments[0].startTime).localeCompare(a.bookingSegments[0].date + a.bookingSegments[0].startTime);

        return {
            todaysBookings: allTodays.sort(sortAsc),
            upcomingBookings: allUpcoming.sort(sortAsc),
            pastBookings: allPast.sort(sortDesc),
        };
      }, [bookings, currentTime]);

      const filteredPastBookings = useMemo(() => {
        return pastBookings.filter(b => {
            const bookingDate = new Date(b.bookingSegments[0].date);
            const monthMatches = selectedMonth === "all" || (bookingDate.getMonth() + 1) === Number(selectedMonth);
            const yearMatches = selectedYear === "all" || bookingDate.getFullYear() === Number(selectedYear);
            return monthMatches && yearMatches;
        });
      }, [pastBookings, selectedMonth, selectedYear]);

      const availableYears = useMemo(() => {
          const yrs = new Set([new Date().getFullYear()]);
          bookings.forEach(b => b.bookingSegments?.forEach(s => yrs.add(new Date(s.date).getFullYear())));
          return Array.from(yrs).sort((a,b) => b-a);
      }, [bookings]);

      return createElement('div', { className: "container mx-auto p-4 md:p-8 max-w-7xl" },
        createElement('header', { className: "flex flex-col sm:flex-row justify-between items-center gap-4 mb-8" },
          createElement('h1', { className: "text-2xl md:text-3xl font-bold text-white tracking-tight" }, "Possible ", createElement('span', { className: "text-yellow-400" }, "Studio "), "Manager"),
          createElement('div', { className: "flex items-center gap-3 print:hidden" },
            isAdmin && createElement('button', { onClick: handleAddNewClick, className: "flex items-center space-x-2 bg-yellow-400 text-black font-bold px-4 py-2 rounded-lg hover:bg-yellow-500 transition-all duration-200 transform hover:scale-105" }, 
              createElement('svg', {xmlns:"http://www.w3.org/2000/svg", fill:"none", viewBox:"0 0 24 24", strokeWidth:2, stroke:"currentColor", className:"w-5 h-5"}, createElement('path', {strokeLinecap:"round", strokeLinejoin:"round", d:"M12 4.5v15m7.5-7.5h-15"})),
              createElement('span', {className:"hidden sm:inline"}, "Add Booking")
            ),
            createElement('button', { onClick: () => isAdmin ? doLogout() : setShowLogin(true), className: "bg-gray-800 text-white font-semibold py-2 px-4 rounded-md hover:bg-gray-700 ring-1 ring-gray-600" }, isAdmin ? "Logout" : "Admin Login")
          )
        ),
        
        successMsg && createElement('div', { className: "bg-green-900/70 border border-green-500/50 text-green-300 px-4 py-3 rounded-md mb-4", role: "alert" }, successMsg),
        error && createElement('div', { className: "bg-red-900/70 border border-red-500/50 text-red-300 px-4 py-3 rounded-md mb-4", role: "alert" }, error),

        createElement(LoginModal, { isOpen: showLogin, onClose: () => setShowLogin(false), onLogin: doLogin }),
        createElement(ConfirmModal, { isOpen: !!bookingToDelete, onClose: () => setBookingToDelete(null), onConfirm: handleConfirmDelete, title: "Delete Booking?", message: "Permanently delete this entry?" }),
        createElement(QRModal, { isOpen: !!qrBooking, onClose: () => setQrBooking(null), onMarkPaid: handleMarkAsPaid, booking: qrBooking }),

        isAdmin && showForm && createElement(RentalForm, { rentalToEdit: editBooking, onSubmitSuccess: handleSuccess, onCancel: handleCancelForm }),

        loading ? createElement(LoadingSpinner) : 
        createElement(Fragment, null, 
          createElement(RentalList, { title: "Today's Shoots", rentals: todaysBookings, isAdmin: isAdmin, onEdit: handleEdit, onRequestDelete: handleRequestDelete, onRequestQR: setQrBooking, isTodayList: true, className: "hide-on-print" }),
          
          createElement('div', { className: "my-8 hide-on-print" },
            createElement(RentalList, { 
              title: "Upcoming Bookings",
              rentals: upcomingBookings,
              isAdmin: isAdmin, 
              onEdit: handleEdit, 
              onRequestDelete: handleRequestDelete,
              onRequestQR: setQrBooking,
            })
          ),
          
          createElement('div', { className: "my-8" },
            createElement('div', { className: "flex flex-wrap items-center justify-between gap-4 mb-6 border-b-2 border-gray-700 pb-2" },
              createElement('h2', { className: "text-3xl font-bold text-yellow-400" }, "Past Bookings"),
              createElement('div', { className: "flex gap-4 print:hidden" },
                createElement('div', null,
                  createElement('label', { htmlFor: "month-filter", className: "font-semibold text-gray-400 mr-2" }, "Month:"),
                  createElement('select', { id: "month-filter", className: "bg-gray-800 border border-gray-700 rounded-md px-2 py-1 text-white", value: selectedMonth, onChange: e => setSelectedMonth(e.target.value) }, 
                    createElement('option', { value: "all" }, "All Months"), MONTHS.map((m,i)=>createElement('option',{key:i,value:i+1},m))
                  )
                ),
                createElement('div', null,
                  createElement('label', { htmlFor: "year-filter", className: "font-semibold text-gray-400 mr-2" }, "Year:"),
                  createElement('select', { id: "year-filter", className: "bg-gray-800 border border-gray-700 rounded-md px-2 py-1 text-white", value: selectedYear, onChange: e => setSelectedYear(e.target.value) }, 
                    createElement('option', { value: "all" }, "All Years"), availableYears.map(y=>createElement('option',{key:y,value:y},y))
                  )
                )
              )
            ),
            createElement(RentalList, { title: "", rentals: filteredPastBookings, isAdmin: isAdmin, onEdit: handleEdit, onRequestDelete: handleRequestDelete, onRequestQR: setQrBooking })
          ),

          createElement('div', { className: "my-8 bg-gray-900 p-6 rounded-xl ring-1 ring-gray-800 summary-print-container" },
            createElement(Summary, { rentals: filteredPastBookings }),
            createElement('button', { onClick: () => window.print(), className: "w-full mt-4 bg-gray-700 text-white px-4 py-2 rounded-md print:hidden" }, "Print Filtered Report")
          )
        )
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(createElement(App));
  </script>
</body>
</html>
